<!-- AUTO-GENERATED by scripts/generate_service_docs.py. DO NOT EDIT DIRECTLY. -->
# PyEngine (`f8.pyengine`)

Python-based execution engine for Feel8 operators.

- Service class: `f8.pyengine`
- Version: `0.0.1`
- Source directory: `f8/engine`
- Tags: `engine`, `python`, `py`

## How to Run

```bash
pixi run f8pyengine
```

- Workdir: `../../../`
- Environment overrides: none

## Service State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `dataDelivery` | `rw` | `false` | `true` | `string / enum[pull, push, both] / default=pull` | How data inputs are delivered to nodes: pull (default), push, or both. |
| `active` | `rw` | `false` | `true` | `boolean / default=True` | Service lifecycle state (activate/deactivate). |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |

## Service Commands

_None_

## Service Data Input Ports

_None_

## Service Data Output Ports

_None_

## Operators

### Tick (`f8.tick`)
Source operator that generates periodic exec ticks.

- Exec in ports: none
- Exec out ports: `exec`

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `tickMs` | `rw` | `false` | `true` | `integer / default=100` | Interval in milliseconds for emitting exec ticks. |
| `hiResTimer` | `rw` | `false` | `false` | `boolean / default=True` | Request 1ms system timer resolution to reduce jitter on Windows. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

_None_

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `processingMs` | `true` | `false` | `integer / default=0` | Per-tick processing time in milliseconds (excluding sleep). |
| `intervalMs` | `true` | `false` | `integer / default=0` | Actual interval between tick starts in milliseconds. |
| `latenessMs` | `true` | `false` | `integer / default=0` | How late this tick started relative to its scheduled deadline (ms). |

### Sequence (`f8.sequence`)
Exec flow splitter: triggers its exec outputs in order (requires DFS scheduling).

- Exec in ports: `exec`
- Exec out ports: `0`, `1`, `2`

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

_None_

#### Data Output Ports

_None_

### Cosine (`f8.cosine`)
Cosine phase transform. Provide `phase` (0..1) from an upstream phase driver (e.g. Phase node).

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `dc` | `rw` | `false` | `false` | `number / default=0.5` | Default DC offset (used when `dc` input is not provided). |
| `amp` | `rw` | `false` | `false` | `number / default=0.5` | Amplitude. |
| `phaseOffset` | `rw` | `false` | `false` | `number / default=0.0` | Normalized phase offset (0.0 to 1.0). |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `phase` | `true` | `true` | `number` | Phase input (0..1). |
| `amp` | `false` | `false` | `number / default=0.5` | Amplitude override. |
| `dc` | `false` | `false` | `number / default=0.5` | DC offset override. |
| `phaseOffset` | `false` | `false` | `number` | Phase offset override (0..1). |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `value` | `true` | `true` | `number` | cosine output |

### Tempest (`f8.tempest`)
Tempest phase transform (phase-modulated cosine). Provide `phase` (0..1) from an upstream phase driver (e.g. Phase node).

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `dc` | `rw` | `false` | `false` | `number / default=0.5` | Default DC offset (used when `dc` input is not provided). |
| `amp` | `rw` | `false` | `false` | `number / default=0.5` | Default amplitude (used when `amp`/`amplitude` input is not provided). |
| `phaseOffset` | `rw` | `false` | `false` | `number / default=0.0` | Fraction of a full cycle added to the phase (0..1). |
| `eccentric` | `rw` | `false` | `false` | `number / default=0.0` | Controls curvature of the inner sine. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `phase` | `true` | `true` | `number` | Phase input (0..1). |
| `amp` | `false` | `false` | `number` | Amplitude override. |
| `phaseOffset` | `false` | `false` | `number` | Phase offset override (0..1). |
| `eccentric` | `false` | `false` | `number` | Eccentricity override |
| `dc` | `false` | `false` | `number` | DC offset override. |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `out` | `true` | `true` | `number` | tempest output |

### Phase (`f8.phase`)
Phase accumulator. Outputs normalized phase (0..1) and unwrapped phase turns.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `hz` | `rw` | `false` | `true` | `number / default=1.0` | Frequency in Hz. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `hz` | `false` | `true` | `number` | Frequency override (Hz). |
| `phase` | `false` | `true` | `number` | Absolute phase override (0..1). |
| `reset` | `false` | `true` | `boolean` | If true, reset phase to 0. |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `phase` | `true` | `true` | `number` | Normalized phase (0..1). |
| `phaseTurns` | `true` | `true` | `number` | Unwrapped phase turns (cycles). |

### Print (`f8.print`)
Exec-driven printer (pulls `value` and prints).

- Exec in ports: `exec`
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `strip` | `wo` | `false` | `false` | `boolean / default=True` | If true, strip whitespace/newlines from the start/end of string values before printing. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `value` | `true` | `true` | `any` | value to print |

#### Data Output Ports

_None_

### Pull (`f8.pull`)
Hidden internal sink that periodically pulls all data inputs to trigger upstream computation.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `autoTriggerEnabled` | `rw` | `false` | `true` | `boolean / default=False` | When enabled, periodically pull all data inputs without exec. |
| `autoTriggerHz` | `rw` | `false` | `true` | `integer / default=10` | Periodic pull frequency in Hz when Auto Trigger is enabled. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

_None_

#### Data Output Ports

_None_

### Program Wave (`f8.program_wave`)
Generate a program-controlled phase/gate waveform from a dict state payload.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `program` | `wo` | `true` | `true` | `any` | Dict payload defining tsMs/timeSec/hz/loopRunningSec/loopPauseSec. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

_None_

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `phaseTurns` | `true` | `true` | `number` | Unwrapped phase turns (cycles). |
| `phase` | `true` | `true` | `number` | Normalized phase (0..1). |
| `active` | `true` | `true` | `boolean` | Whether program is in a running window. |
| `done` | `true` | `true` | `boolean` | Whether program finished (timeSec elapsed). |
| `elapsedSec` | `true` | `true` | `number` | Elapsed seconds since start. |

### Envelope (`f8.envelope`)
Tracks upper/lower envelopes and emits normalized + confidence outputs.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `method` | `rw` | `false` | `true` | `string / enum[EMA, DEMA, SMA] / default=EMA` | Envelope filter method. |
| `rise_alpha` | `rw` | `false` | `true` | `number / default=0.4` | Smoothing factor when moving toward the envelope. |
| `fall_alpha` | `rw` | `false` | `true` | `number / default=0.05` | Smoothing factor when moving away from the envelope. |
| `min_span` | `rw` | `false` | `true` | `number / default=0.25` | Minimum enforced envelope span. |
| `sma_window` | `rw` | `false` | `true` | `number / default=10` | Window size for SMA mode. |
| `margin` | `rw` | `false` | `false` | `number / default=0.0` | Extra margin added to envelopes before normalization. |
| `jumpEnabled` | `rw` | `false` | `false` | `boolean / default=True` | Enable consecutive-frame jump detection and reseed. |
| `jumpSpanMult` | `rw` | `false` | `false` | `number / default=4.0` | Distance threshold in envelope-span units for jump detection. |
| `jumpConsecutiveFrames` | `rw` | `false` | `false` | `number / default=4` | Consecutive far frames required before jump trigger. |
| `jumpReseedFrames` | `rw` | `false` | `false` | `number / default=8` | Blend length (frames) after jump reset. |
| `jumpResetConfidence` | `rw` | `false` | `false` | `boolean / default=True` | Reset confidence history when jump reset is triggered. |
| `confidenceEnabled` | `rw` | `false` | `false` | `boolean / default=True` | Enable periodicity confidence estimation. |
| `confidenceWindow` | `rw` | `false` | `false` | `number / default=128` | Sliding window size for autocorrelation confidence. |
| `confidenceMinLag` | `rw` | `false` | `false` | `number / default=4` | Minimum lag used in autocorrelation scan. |
| `confidenceMaxLag` | `rw` | `false` | `false` | `number / default=48` | Maximum lag used in autocorrelation scan. |
| `confidencePeakProminence` | `rw` | `false` | `false` | `number / default=0.1` | Minimum local prominence for valid autocorrelation peaks. |
| `confidenceMinPeaks` | `rw` | `false` | `false` | `number / default=1` | Minimum valid autocorrelation peaks before full confidence. |
| `confidenceSmoothingAlpha` | `rw` | `false` | `false` | `number / default=0.25` | EMA smoothing factor for confidence output. |
| `confidenceNoiseFloor` | `rw` | `false` | `false` | `number / default=0.0001` | Minimum energy needed before periodicity confidence can rise. |
| `confidenceResetOnMissing` | `rw` | `false` | `false` | `boolean / default=False` | Decay confidence when input is missing. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `value` | `false` | `true` | `number` | Input value. |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `lower` | `true` | `true` | `number` | Estimated lower envelope. |
| `upper` | `true` | `true` | `number` | Estimated upper envelope. |
| `normalized` | `true` | `true` | `number` | Normalized value (0..1). |
| `confidence` | `true` | `true` | `number / default=0.0` | Periodicity confidence estimate (0..1). |

### Axis Envelope (`f8.axis_envelope`)
Estimate normalized amplitudes along major/minor axes from 2D input.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `ema_alpha` | `rw` | `false` | `true` | `number / default=0.2` | EMA smoothing for center/covariance tracking. |
| `method` | `rw` | `false` | `true` | `string / enum[EMA, DEMA, SMA] / default=EMA` | Envelope filter method. |
| `rise_alpha` | `rw` | `false` | `true` | `number / default=0.4` | Smoothing factor when moving toward the envelope. |
| `fall_alpha` | `rw` | `false` | `true` | `number / default=0.05` | Smoothing factor when moving away from the envelope. |
| `min_span` | `rw` | `false` | `true` | `number / default=0.25` | Minimum enforced envelope span. |
| `sma_window` | `rw` | `false` | `true` | `number / default=10` | Window size for SMA mode. |
| `margin` | `rw` | `false` | `false` | `number / default=0.0` | Extra margin added to the envelopes before normalization. |
| `reset_z` | `rw` | `false` | `false` | `number / default=8.0` | Proportional outlier threshold. If a sample is >= this many sigma (2D) or spans (1D) away, reset and ignore it (0 disables). |
| `reset_abs_max` | `rw` | `false` | `false` | `number / default=0.0` | Legacy absolute outlier threshold; if abs(x) or abs(y) exceeds this value, reset and ignore the sample (0 disables). |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `x` | `false` | `true` | `number` | X coordinate. |
| `y` | `false` | `true` | `number` | Y coordinate. |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `major` | `true` | `true` | `number` | Normalized amplitude along the major axis (0..1). |
| `minor` | `true` | `true` | `number` | Normalized amplitude along the minor axis (0..1). |

### Smooth Filter (`f8.smooth_filter`)
Smooths scalar or vector inputs with EMA/DEMA/One Euro filtering.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `filter_type` | `rw` | `false` | `true` | `string / enum[NONE, EMA, DEMA, ONEEURO] / default=EMA` | Filter type. |
| `ema_alpha` | `rw` | `false` | `true` | `number / default=0.4` | EMA smoothing factor (0..1). |
| `dema_alpha` | `rw` | `false` | `true` | `number / default=0.4` | DEMA smoothing factor (0..1). |
| `one_euro_min_cutoff` | `rw` | `false` | `true` | `number / default=1.5` | Minimum cutoff frequency. |
| `one_euro_beta` | `rw` | `false` | `true` | `number / default=0.0` | Speed coefficient for dynamic cutoff. |
| `one_euro_derivative_cutoff` | `rw` | `false` | `true` | `number / default=1.0` | Cutoff frequency for the derivative filter. |
| `one_euro_default_freq` | `rw` | `false` | `true` | `number / default=90.0` | Default sampling frequency (Hz). |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `value` | `true` | `true` | `any` | Value to filter. |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `value` | `true` | `true` | `any` | Filtered output. |

### Range Map (`f8.range_map`)
Clip input to [inMin,inMax] then remap to [outMin,outMax] with a curve.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `inMin` | `rw` | `false` | `false` | `number / default=0.0` | Input range minimum. |
| `inMax` | `rw` | `false` | `false` | `number / default=1.0` | Input range maximum. |
| `outMin` | `rw` | `false` | `true` | `number / default=0.0` | Output range minimum. |
| `outMax` | `rw` | `false` | `true` | `number / default=1.0` | Output range maximum. |
| `curve` | `rw` | `false` | `true` | `string / enum[LINEAR, SMOOTHSTEP, SMOOTHERSTEP, EASE_IN, EASE_OUT, ...] / default=LINEAR` | Mapping curve. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `value` | `false` | `true` | `number` | Input value. |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `value` | `true` | `true` | `number` | Mapped output. |

### Rate Limiter (`f8.rate_limiter`)
Limits the rate of change (and optionally acceleration) of an input signal.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `inMin` | `rw` | `false` | `false` | `number / default=0.0` | Input/output clamp minimum (typical 0). |
| `inMax` | `rw` | `false` | `false` | `number / default=1.0` | Input/output clamp maximum (typical 1). |
| `maxRateUp` | `rw` | `false` | `true` | `number / default=2.0` | Maximum rising rate (units/sec). |
| `maxRateDown` | `rw` | `false` | `true` | `number / default=2.0` | Maximum falling rate (units/sec). |
| `maxAccel` | `rw` | `false` | `false` | `number / default=0.0` | Maximum acceleration (units/sec^2). 0 disables acceleration limiting. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `value` | `false` | `true` | `number` | Input value. |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `value` | `true` | `true` | `number` | Rate-limited output. |

### UDP Skeleton (`f8.udp_skeleton`)
Receives UDP packets and keeps latest skeleton per model key, with TTL cleanup and selection.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `bindAddress` | `rw` | `false` | `false` | `string / default=127.0.0.1` | Local address to bind (loopback by default). |
| `allowNonLoopbackBind` | `rw` | `false` | `false` | `boolean / default=False` | When true, allow bindAddress values other than loopback. |
| `port` | `rw` | `false` | `true` | `integer / default=39540` | UDP listen port. |
| `maxQueue` | `rw` | `false` | `false` | `integer / default=512` | Max queued packets before dropping (1..4096). |
| `reuseAddress` | `rw` | `false` | `false` | `boolean / default=False` | Best-effort: allow multiple listeners on same (address, port) if OS supports. |
| `cleanupAfterMs` | `wo` | `false` | `false` | `integer / default=10000` | Remove models that haven't updated for this many ms (<=0 disables cleanup). |
| `selectedKey` | `rw` | `false` | `true` | `string / default=` | If set and matches an available key, outputs `selectedSkeleton`; otherwise None. |
| `availableKeys` | `ro` | `false` | `true` | `array[string]` | Read-only list of current keys (updated only on changes). |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

_None_

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `skeletons` | `true` | `true` | `any` | List of latest payloads (ordered by key). |
| `selectedSkeleton` | `true` | `true` | `any` | Latest payload matching `selectedKey` (or None). |

### Serial Out (`f8.serial_out`)
Writes incoming values to a serial port (pyserial).

- Exec in ports: `exec`
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `enabled` | `rw` | `false` | `true` | `boolean / default=True` | Enable/disable serial output. |
| `port` | `rw` | `false` | `true` | `string / default=COM4` | Serial port name (e.g., COM3). |
| `baudrate` | `wo` | `false` | `false` | `integer / default=115200` | Serial baud rate. |
| `encoding` | `rw` | `false` | `false` | `string / default=ascii` | Deprecated. Serial Out always encodes as ASCII for TCode devices. |
| `newline` | `rw` | `false` | `false` | `string / default=` | Deprecated. Provide newline in the input payload if needed. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `value` | `true` | `true` | `any` | Value to write. |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `isOpen` | `true` | `true` | `boolean / default=False` | Whether serial port is open. |
| `writtenBytes` | `true` | `true` | `integer / default=0` | Bytes written by last exec. |
| `error` | `true` | `true` | `string / default=` | Last error (if any). |

### TCode (`f8.tcode`)
Generates TCode v0.3 command strings from normalized axis values.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `intervalMs` | `rw` | `false` | `true` | `number / default=20` | Default interval appended as `I###` when `intervalMs` input is not provided. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `L0` | `true` | `true` | `number` | Axis L0 (0..1). |
| `L1` | `true` | `false` | `number` | Axis L1 (0..1). |
| `L2` | `true` | `false` | `number` | Axis L2 (0..1). |
| `R0` | `true` | `false` | `number` | Axis R0 (0..1). |
| `R1` | `true` | `false` | `number` | Axis R1 (0..1). |
| `R2` | `true` | `false` | `number` | Axis R2 (0..1). |
| `V0` | `true` | `false` | `number` | Axis V0 (0..1). |
| `V1` | `true` | `false` | `number` | Axis V1 (0..1). |
| `A0` | `true` | `false` | `number` | Axis A0 (0..1). |
| `A1` | `true` | `false` | `number` | Axis A1 (0..1). |
| `intervalMs` | `true` | `false` | `number / default=20` | Optional interval override in milliseconds (rounded, min 1). |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `tcode` | `true` | `true` | `string` | TCode v0.3 command string |

### Python Script (`f8.python_script`)
Execute Python code with onStart/onState/onMsg/onExec/onStop hooks.

- Exec in ports: `exec`
- Exec out ports: `exec`

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `code` | `rw` | `false` | `false` | `string / default=# Define hooks (any subset is ok):<br># - onStart(ctx)<br># - onState(ctx, field, value, tsMs=None)      # called on state updates (except 'code')<br># - onMsg(ctx, inputs)                        # called on data arrival (push mode) or as fallback for exec<br># - onExec(ctx, execIn, inputs)               # called on exec trigger (pull mode)<br># - onStop(ctx)<br># - ctx['locals'] is preserved between calls (script-local memory)<br># - ctx['execIn'] is set for exec-triggered calls<br># - State helpers:<br>#   - await ctx['get_state'](field)           # read state value<br>#   - ctx['get_state_cached'](field, default=None)  # sync cached snapshot (may be stale)<br>#   - ctx['set_state'](field, value)          # write state (fire-and-forget)<br>#   - await ctx['set_state_async'](field, value)<br># - Video SHM helpers:<br>#   - ctx['subscribe_video_shm'](key, shm_name, decode='auto', use_event=False)<br>#   - pkt = ctx['get_video_shm'](key)          # latest cached packet or None<br>#   - ctx['unsubscribe_video_shm'](key)<br>#   - ctx['list_video_shm_subscriptions']()<br>#   Note: for best UI/graph support, add the target state fields on the node (editableStateFields=True).<br># - inputs is a dict keyed by input port names<br># Return value protocol:<br># - onMsg: return {'outputs': {...}} or any value (emits to 'out' if present)<br># - onExec: return {'exec': ['exec','exec2'], 'outputs': {...}}<br>#   - 'exec' selects exec out port(s) to trigger (defaults to pass-through)<br>#   - 'outputs' is a dict mapping dataOutPort -> value<br><br>def onStart(ctx):<br>    ctx['log']('python_script started')<br><br>def onState(ctx, field, value, tsMs=None):<br>    # Example: react to a state change.<br>    # ctx['log'](f'state {field}={value} tsMs={tsMs}')<br>    return<br><br>def onMsg(ctx, inputs):<br>    msg = inputs.get('msg')<br>    return {'outputs': {'out': msg}}<br><br>def onExec(ctx, execIn, inputs):<br>    # Example: choose different exec outputs by execIn port name.<br>    if execIn == 'exec2':<br>        return {'exec': ['exec2'], 'outputs': {'out': inputs.get('msg')}}<br>    return {'exec': ['exec'], 'outputs': {'out': inputs.get('msg')}}<br><br>def onStop(ctx):<br>    ctx['log']('python_script stopped')<br>` | Python source code defining onStart(ctx), onMsg(ctx, inputs), onStop(ctx). |
| `lastError` | `wo` | `false` | `false` | `string / default=` | Last script error (compile/runtime). |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `msg` | `true` | `true` | `any` | Message input |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `out` | `true` | `true` | `any` | Script output |

### Python Expr (`f8.expr`)
Evaluate a small expression using input values (math/logic/extraction).

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `allowNumpy` | `rw` | `false` | `false` | `boolean / default=False` | Enable numpy calls in expressions (np.*, numpy.*). |
| `unpackDictOutputs` | `rw` | `false` | `false` | `boolean / default=False` | When enabled, dict results are emitted by matching output port names. |
| `code` | `rw` | `false` | `true` | `string / default=x` | Single-line expression (no statements). Available: abs/min/max/round/float/int, math.*, comprehensions. Numpy (np.*, numpy.*) is available only when Allow Numpy is enabled. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `x` | `false` | `true` | `any` | Input value for the expression. |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `out` | `false` | `true` | `any` | Expression result. |

### Buttplug Bridge (`f8.buttplug_bridge`)
Connect to Intiface/Buttplug, publish device capabilities, and drive selected device outputs.

- Exec in ports: `exec`
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `enabled` | `rw` | `false` | `true` | `boolean / default=True` | Enable bridge connection and output control. |
| `wsUrl` | `rw` | `false` | `true` | `string / default=ws://127.0.0.1:12345` | Buttplug server websocket URL. |
| `autoConnect` | `rw` | `false` | `true` | `boolean / default=True` | Automatically connect while enabled. |
| `autoScanOnConnect` | `rw` | `false` | `false` | `boolean / default=True` | Start and stop scan once after connect. |
| `scanDurationMs` | `rw` | `false` | `false` | `integer / default=5000` | Scan duration before stop when scan is triggered. |
| `reconnectIntervalMs` | `rw` | `false` | `false` | `integer / default=2000` | Reconnect throttle interval. |
| `selectedDevice` | `rw` | `false` | `true` | `string / default=` | Target token: "index\|name". |
| `rescan` | `rw` | `false` | `true` | `boolean / default=False` | Set true to trigger one scan cycle; runtime resets it to false. |
| `vibrateFeatureIndex` | `rw` | `false` | `false` | `integer / default=-1` | Feature index for vibrate (-1 = all). |
| `rotateFeatureIndex` | `rw` | `false` | `false` | `integer / default=-1` | Feature index for rotate (-1 = all). |
| `oscillateFeatureIndex` | `rw` | `false` | `false` | `integer / default=-1` | Feature index for oscillate (-1 = all). |
| `positionFeatureIndex` | `rw` | `false` | `false` | `integer / default=-1` | Feature index for position (-1 = all). |
| `defaultPositionDurationMs` | `rw` | `false` | `false` | `integer / default=500` | Default duration for position output. |
| `stopOnDeactivate` | `rw` | `false` | `false` | `boolean / default=True` | Send stop command when service deactivates. |
| `connected` | `ro` | `false` | `true` | `boolean / default=False` | True when websocket is connected. |
| `scanning` | `ro` | `false` | `false` | `boolean / default=False` | True while scanning is active. |
| `availableDevices` | `ro` | `false` | `false` | `array[string]` | Device tokens for selection UI. |
| `deviceInfos` | `ro` | `false` | `false` | `any` | Full discovered device infos. |
| `selectedDeviceInfo` | `ro` | `false` | `true` | `any` | Current selected device info object. |
| `lastError` | `ro` | `false` | `true` | `string / default=` | Last runtime error. |
| `sentCommands` | `ro` | `false` | `false` | `integer / default=0` | Total sent output/stop commands. |
| `lastCommandTsMs` | `ro` | `false` | `false` | `integer / default=0` | Timestamp of last sent command. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `vibrate` | `true` | `true` | `number` | Vibrate intensity (0..1). |
| `rotate` | `true` | `true` | `number` | Rotate speed (-1..1). |
| `oscillate` | `true` | `true` | `number` | Oscillate intensity (0..1). |
| `position` | `true` | `true` | `number` | Position target (0..1). |
| `positionDurationMs` | `false` | `true` | `number / default=500` | Optional position duration in milliseconds. |
| `stop` | `false` | `true` | `boolean / default=False` | When true on exec, stop output on selected device. |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `connected` | `true` | `true` | `boolean / default=False` | Current connection status. |
| `selectedDeviceInfo` | `true` | `true` | `any` | Selected device info object. |
| `error` | `true` | `true` | `string / default=` | Last error string. |

### Lovense Mock Server (`f8.lovense_mock_server`)
Event-driven input node that mocks the Lovense Local API and publishes received commands as state.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `bindAddress` | `rw` | `false` | `true` | `string / default=127.0.0.1` | Local address to bind (loopback by default). |
| `allowNonLoopbackBind` | `rw` | `false` | `false` | `boolean / default=False` | When true, allow bindAddress values other than loopback. |
| `port` | `rw` | `false` | `true` | `integer / default=30010` | HTTP port for the mock Lovense server. |
| `printEnabled` | `rw` | `false` | `false` | `boolean / default=False` | If enabled, logs raw incoming requests and outgoing responses (debug). |
| `eventIncludePayload` | `rw` | `false` | `false` | `boolean / default=False` | Include the parsed request payload in the `event` state (debug). |
| `eventIncludeRequest` | `rw` | `false` | `false` | `boolean / default=False` | Include request headers/body in the `event` state (debug). |
| `listening` | `ro` | `false` | `true` | `boolean / default=False` | True if the HTTP server is currently listening. |
| `lastError` | `ro` | `false` | `true` | `string / default=` | Last server error (e.g. bind failure). |
| `event` | `ro` | `false` | `true` | `any` | Latest received Lovense command (dict with seq/eventId/summary/raw). |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

_None_

#### Data Output Ports

_None_

### Lovense Program Adapter (`f8.lovense_program_adapter`)
Convert Lovense Mock Server events into ProgramWave input + amplitude.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `lovenseEvent` | `wo` | `false` | `true` | `any` | State-edge input from Lovense Mock Server: the latest event dict. |
| `program` | `ro` | `false` | `true` | `any` | Readonly output: ProgramWave-compatible dict (tsMs/timeSec/hz/loopRunningSec/loopPauseSec). |
| `amplitude` | `ro` | `false` | `true` | `number / default=0.0` | Readonly output: normalized amplitude (0..1). |
| `kind` | `ro` | `false` | `false` | `string / default=` | Readonly output: event kind (debug). |
| `sequence` | `ro` | `false` | `false` | `any` | Readonly output: sequence dict for Sequence Player (typically pattern -> hz sequence). |
| `minHz` | `rw` | `false` | `false` | `number / default=0.0` | Frequency at thrusting=0. |
| `maxHz` | `rw` | `false` | `false` | `number / default=3.0` | Frequency at thrusting=thrustingMax. |
| `thrustingMax` | `rw` | `false` | `false` | `number / default=20.0` | Normalize thrusting value by this maximum. |
| `depthMax` | `wo` | `false` | `false` | `number / default=3.0` | Normalize depth value by this maximum (amplitude). |
| `speedGamma` | `wo` | `false` | `false` | `number / default=1.0` | Nonlinear curve for thrusting->speed (>=0.01). |
| `vibrateHz` | `wo` | `false` | `false` | `number / default=2.0` | Default program frequency for All: vibration events. |
| `vibrateMax` | `rw` | `false` | `false` | `number / default=20.0` | Normalize All: vibration strength by this maximum. |
| `patternMinHz` | `rw` | `false` | `false` | `number / default=0.0` | Pattern strength=0 mapped Hz minimum. |
| `patternMaxHz` | `rw` | `false` | `false` | `number / default=5.0` | Pattern strength=patternStrengthMax mapped Hz maximum. |
| `patternStrengthMax` | `rw` | `false` | `false` | `number / default=20.0` | Normalize Pattern strength values by this maximum before mapping to Hz. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

_None_

#### Data Output Ports

_None_

### Sequence Player (`f8.sequence_player`)
Play a step-sequence over time (epoch-based), outputting the current step value.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `sequence` | `wo` | `true` | `true` | `any` | Dict payload defining tsMs/stepMs/values/timeSec. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

_None_

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `value` | `true` | `true` | `number` | Current step value. |
| `index` | `true` | `true` | `integer` | Current 0-based step index. |
| `active` | `true` | `true` | `boolean` | Whether still playing. |
| `done` | `true` | `true` | `boolean` | Whether playback ended. |
| `elapsedSec` | `true` | `true` | `number` | Elapsed seconds since start. |

### Mix (Silence Fill) (`f8.mix_silence_fill`)
Outputs A by default; when A is silent for a while, crossfades to B as filler.

- Exec in ports: `exec`
- Exec out ports: `exec`

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `silenceMs` | `rw` | `false` | `true` | `integer / default=500` | If A changes less than deltaThreshold for this long, fade to B. |
| `deltaThreshold` | `rw` | `false` | `true` | `number / default=0.001` | Absolute change threshold to treat A as active. |
| `fadeMs` | `rw` | `false` | `true` | `integer / default=200` | Crossfade time (0=instant). |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `A` | `true` | `true` | `number` | Primary signal |
| `B` | `true` | `true` | `number` | Filler signal |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `out` | `true` | `true` | `number` | Mixed output |
| `alpha` | `true` | `true` | `number` | Crossfade factor (0=A, 1=B) |
| `silent` | `true` | `true` | `number` | 1 if A is considered silent else 0 |

### Playback Sync (`f8.playback_sync`)
Extrapolates IMPlayer playback position between sparse telemetry updates.

- Exec in ports: none
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `maxExtrapolateMs` | `rw` | `false` | `false` | `integer / default=1000` | Limit extrapolation horizon to avoid drift when telemetry is stale (0 = unlimited). |
| `playbackRate` | `rw` | `false` | `false` | `number / default=1.0` | Rate multiplier used for extrapolation when playing. |
| `clampToDuration` | `rw` | `false` | `false` | `boolean / default=True` | Clamp estimated position to latest duration when available. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `playback` | `false` | `true` | `any` | Playback payload from f8.implayer/playback (position/duration/playing/videoId). |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `position` | `true` | `true` | `number` | Estimated playback position (seconds). |
| `rawPosition` | `true` | `false` | `number` | Latest raw position from playback payload (seconds). |
| `duration` | `true` | `false` | `number` | Latest duration (seconds). |
| `playing` | `true` | `false` | `boolean` | Latest playing flag. |
| `videoId` | `true` | `false` | `string` | Latest video id. |
| `ageMs` | `true` | `false` | `integer` | Age of latest playback sample in milliseconds. |
| `stale` | `true` | `false` | `boolean` | True if sample age exceeds max extrapolation window. |

### Handy Out (`f8.handy_out`)
Drive The Handy via HDSP using normalized 0..1 input values.

- Exec in ports: `exec`
- Exec out ports: none

#### State Fields

| Name | Access | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- | --- |
| `enabled` | `rw` | `false` | `true` | `boolean / default=True` | Enable/disable Handy output. |
| `connectionKey` | `rw` | `false` | `true` | `string / default=` | The Handy X-Connection-Key value. |
| `baseUrl` | `rw` | `false` | `true` | `string / default=https://www.handyfeeling.com/api/handy/v2` | Handy API base URL. |
| `ensureHdspMode` | `rw` | `false` | `true` | `boolean / default=True` | Automatically set mode=HDSP before sending position commands. |
| `invert` | `rw` | `false` | `true` | `boolean / default=False` | Invert 0..1 input mapping before percent conversion. |
| `minPercent` | `rw` | `false` | `true` | `number / default=0.0` | Mapped output minimum in percent. |
| `maxPercent` | `rw` | `false` | `true` | `number / default=100.0` | Mapped output maximum in percent. |
| `defaultDurationMs` | `rw` | `false` | `true` | `integer / default=100` | Default /hdsp/xpt duration when durationMs input is not provided. |
| `requestTimeoutMs` | `rw` | `false` | `false` | `integer / default=5000` | HTTP request timeout for Handy API calls. |
| `minSendIntervalMs` | `rw` | `false` | `true` | `integer / default=0` | Minimum interval between sent commands (0 means follow tick rate). |
| `immediateResponse` | `rw` | `false` | `false` | `boolean / default=False` | Default immediateResponse value for /hdsp/xpt. |
| `stopOnTarget` | `rw` | `false` | `false` | `boolean / default=False` | Default stopOnTarget value for /hdsp/xpt. |
| `lastError` | `ro` | `false` | `true` | `string / default=` | Last runtime error message. |
| `lastHttpStatus` | `ro` | `false` | `true` | `integer / default=0` | Last HTTP status code from Handy API. |
| `lastResult` | `ro` | `false` | `true` | `number / default=0.0` | Last Handy RPC result value. |
| `sentCommands` | `ro` | `false` | `false` | `integer / default=0` | Total successfully sent HDSP commands. |
| `droppedCommands` | `ro` | `false` | `false` | `integer / default=0` | Commands dropped due to backoff or minSendInterval filtering. |
| `lastSentTsMs` | `ro` | `false` | `false` | `integer / default=0` | Timestamp of the last successful HDSP command. |
| `svcId` | `ro` | `false` | `false` | `string` | Readonly: current service instance id (svcId). |
| `operatorId` | `ro` | `false` | `false` | `string` | Readonly: current operator/node id (operatorId). |

#### Data Input Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `value` | `true` | `true` | `number` | Normalized position input (0..1). |
| `durationMs` | `false` | `true` | `number / default=100` | Optional duration override for /hdsp/xpt. |
| `immediateResponse` | `false` | `true` | `boolean / default=False` | Optional immediate response override for /hdsp/xpt. |
| `stopOnTarget` | `false` | `true` | `boolean / default=False` | Optional stopOnTarget override for /hdsp/xpt. |

#### Data Output Ports

| Name | Required | On Node | Schema | Description |
| --- | --- | --- | --- | --- |
| `sentPosition` | `true` | `true` | `number / default=0.0` | Last sent position percent (0..100). |
| `httpStatus` | `true` | `true` | `integer / default=0` | Last HTTP status code. |
| `result` | `true` | `true` | `number / default=0.0` | Last RPC result code. |
| `error` | `true` | `true` | `string / default=` | Last runtime error. |

## Usage Guide (Manual)

### Recommended Use Cases

- Build operator pipelines for signal processing and device control.
- Bridge service outputs into composable runtime logic.

### Minimal Run Example

```bash
pixi run -e default engine
```

### Operator Composition Notes

- Keep time-base generation (`tick`, `phase`, `program_wave`) separated from mapping stages (`range_map`, `smooth_filter`, `rate_limiter`).
- Use dedicated adapter operators (`lovense_program_adapter`, `buttplug_bridge`) to isolate protocol translation from signal logic.
- `f8.expr` is an operator inside `f8.pyengine`; if you need a standalone service-level expression runtime, use `f8.pyexpr`.
- For reusable chains, keep clear input/output contracts and avoid hidden side effects.

### Common Pitfalls

- Mixed push/pull data delivery can cause unintended ordering assumptions.
- Overly dense operator graphs make runtime diagnosis difficult.

### Troubleshooting

- Start with a minimal chain and add one operator at a time.
- Inspect service and operator state ports to locate stale or invalid values.
